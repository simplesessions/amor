var Amortizer,AmortizerRenderer;Amortizer=function(){function t(t,r,e,n){this.years=t,this.loanAmount=r,this.interest=e,this.startDate=n,this.extraPrincipalPayments=[],this.update(this.years,this.loanAmount,this.interest,this.startDate)}return t.prototype.loadPaymentsFrom=function(t){var r;return r=new XMLHttpRequest,r.open("GET",t,!0),r.onload=function(t){return function(){return r.status>=200&&r.status<400?t.parseJSONPaymentData(JSON.parse(r.responseText)):console.log("Error loading payments from file")}}(this),r.onerror=function(){return console.log("Error connecting while trying to load payments from file")},r.send()},t.prototype.parseJSONPaymentData=function(t){var r,e,n,a;for(a=[],r=0,e=t.length;e>r;r++)n=t[r],a.push(this.payExtra(n.year+"-"+n.month+"-01",n.amount));return a},t.prototype.update=function(t,r,e,n){return this.years=t,this.loanAmount=r,this.interest=e,this.startDate=n,this.stateDate=moment(this.stateDate),this.numPayments=12*this.years,this.monthlyPayment=this.calculateMonthlyPayment(),this.totalPayment=this.monthlyPayment*this.numPayments,this.totalInterest=this.totalPayment-this.loanAmount},t.prototype.payExtra=function(t,r){var e;return t=moment(t).format("YYYY-MM-DD"),e=parseFloat(r),t in this.extraPrincipalPayments?this.extraPrincipalPayments[t].push(e):this.extraPrincipalPayments[t]=[e]},t.prototype.calculateMonthlyPayment=function(){var t;return t=this.interest/12,this.loanAmount*t*Math.pow(1+t,this.numPayments)/(Math.pow(1+t,this.numPayments)-1)},t.prototype.paymentForBalance=function(t){var r,e,n;return e=this.interest/12*t,n=this.monthlyPayment-e,n>=t?(n=t,r=0):r=t-(this.monthlyPayment-this.interest/12*t),{interestPmt:e,principalPmt:n,balance:r}},t.$=function(t){return accounting.formatMoney(Math.round(100*t)/100)},t.emptyRow=function(){return{year:"undefined",interestPmt:0,principalPmt:0,balance:0}},t.prototype.buildTable=function(){var r,e,n,a,i,o,s,m,h,u,l,y,p;for(a="",n=this.startDate,m=12*this.years,e=this.loanAmount,p=t.emptyRow(),p.year=this.startDate.format("YYYY"),h=i=0,u=m;u>=0?u>i:i>u;h=u>=0?++i:--i){if(y=this.paymentForBalance(e),e=y.balance,a+=AmortizerRenderer.buildStandardRow(n,y),n.format("YYYY-MM-DD")in this.extraPrincipalPayments)for(l=this.extraPrincipalPayments[n.format("YYYY-MM-DD")],o=0,s=l.length;s>o;o++)r=l[o],e-=r,a+=AmortizerRenderer.buildExtraPaymentRow(n,r,e);if(p.interestPmt+=y.interestPmt,p.principalPmt+=y.principalPmt,p.balance+=e,n=n.add(1,"months"),n.format("YYYY")!==p.year&&(a+=AmortizerRenderer.buildYearSummaryRow(p.year,p.interestPmt,p.principalPmt,e),p=t.emptyRow(),p.year=n.format("YYYY")),0===e)break}return a},t}(),AmortizerRenderer=function(){function t(){}return t.buildStandardRow=function(t,r){var e;return e="<tr>",e+="<td>"+t.format("MMM YYYY")+"</td>",e+="<td>"+Amortizer.$(r.interestPmt)+"</td>",e+="<td>"+Amortizer.$(r.principalPmt)+"</td>",e+="<td>"+Amortizer.$(r.balance)+"</td>",e+="</tr>"},t.buildExtraPaymentRow=function(t,r,e){var n;return n='<tr class="extra">',n+="<td>"+t.format("MMM YYYY")+" +</td>",n+="<td>&ndash;</td>",n+="<td>(+) "+Amortizer.$(r)+"</td>",n+="<td>"+Amortizer.$(e)+"</td>",n+="</tr>"},t.buildYearSummaryRow=function(t,r,e,n){var a;return a='<tr class="year-summary">',a+="<th>"+t+"</th>",a+="<th>"+Amortizer.$(r)+"</th>",a+="<th>"+Amortizer.$(e)+"</th>",a+="<th>"+Amortizer.$(n)+"</th>",a+="</tr>"},t}();
//# sourceMappingURL=./amortizer.js.map